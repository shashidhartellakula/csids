{% extends "base.html" %}
{% block title %}Results{% endblock %}
{% block page_title %}Detection Results ‚Äî {{ user }}{% endblock %}

{% block content %}
<div style="max-width:900px;">

    <!-- SUMMARY BAR -->
    <div class="panel mb-4">
        <div class="panel-body" style="padding:16px 20px;">
            <div style="display:flex;align-items:center;gap:32px;flex-wrap:wrap;">
                <div>
                    <div class="stat-label">User</div>
                    <div class="mono" style="color:var(--accent);font-size:18px;">{{ user }}</div>
                </div>
                <div>
                    <div class="stat-label">Sequences Analyzed</div>
                    <div class="mono" style="font-size:18px;color:var(--bright);">{{ total }}</div>
                </div>
                <div>
                    <div class="stat-label">Alerts</div>
                    {% if alerts %}
                    <div class="mono" style="font-size:18px;color:var(--red);">
                        {{ alerts|length }} üö®
                    </div>
                    {% else %}
                    <div class="mono" style="font-size:18px;color:var(--green);">
                        0 ‚úÖ
                    </div>
                    {% endif %}
                </div>
                <div style="margin-left:auto;display:flex;gap:10px;">
                    <a href="{{ url_for('download_report', username=user) }}"
                       class="btn btn-primary">‚Üì PDF Report</a>
                    <a href="{{ url_for('analyze') }}"
                       class="btn btn-success">‚Üê New Analysis</a>
                </div>
            </div>
        </div>
    </div>

    {% if alerts %}

    <!-- ALERTS TABLE -->
    <div class="panel">
        <div class="panel-header">
            <div class="panel-title">üö® Intrusion Alerts</div>
            <span style="font-size:12px;color:var(--dim);">
                {{ alerts|length }} suspicious sequence(s) found
            </span>
        </div>
        <div class="panel-body" style="padding:0;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Sequence</th>
                        <th>Reason</th>
                        <th>Risk</th>
                        <th>Risky Commands</th>
                        <th>Seen</th>
                    </tr>
                </thead>
                <tbody>
                {% for a in alerts %}
                <tr>
                    <td style="color:var(--dim);">{{ loop.index }}</td>

                    <td class="mono"
                        style="max-width:240px;overflow:hidden;
                               text-overflow:ellipsis;white-space:nowrap;"
                        title="{{ a['sequence'] }}">
                        {{ a['sequence'] }}
                    </td>

                    <td style="font-size:12px;color:var(--dim);">
                        {{ a['reason'] }}
                    </td>

                    <td>
                        {% set rs = a['risk_score'] %}
                        {% if rs >= 6 %}
                            <span class="badge badge-high">{{ rs }}</span>
                        {% elif rs >= 3 %}
                            <span class="badge badge-medium">{{ rs }}</span>
                        {% else %}
                            <span class="badge badge-low">{{ rs }}</span>
                        {% endif %}
                    </td>

                    <td>
                        {% for cmd in a['risky'] %}
                        <span class="tag">{{ cmd }}</span>
                        {% endfor %}
                    </td>

                    <td class="mono"
                        style="color:{% if a['frequency'] == 0 %}
                                   var(--red)
                               {% else %}
                                   var(--orange)
                               {% endif %};">
                        {{ a['frequency'] }}x
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% else %}

    <!-- NO ALERTS -->
    <div class="panel" style="text-align:center;padding:60px 20px;">
        <div style="font-size:48px;margin-bottom:16px;">‚úÖ</div>
        <div style="font-family:var(--ui);font-size:20px;
                    color:var(--green);letter-spacing:2px;">
            NO INTRUSIONS DETECTED
        </div>
        <div style="color:var(--dim);font-size:14px;margin-top:8px;">
            All {{ total }} sequences match the normal profile for
            <span style="color:var(--accent);">{{ user }}</span>.
        </div>
    </div>

    {% endif %}

</div>
{% endblock %}